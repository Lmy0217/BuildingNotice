# API v0.1-alpha1

## **上传图片**
上传图片到服务器。上传时，请使用 HTTP POST 方式，其中 enctype 为 'multipart/form-data'
#### API地址
[POST] /image/upload
#### POST参数 (非Json)
|参数|类型|说明|
|-|-|-|
|file|File|(必填) 需要上传的图片文件|
|depict|String|(必填) 图片描述|
#### 返回数据 (Json)
|参数|类型|说明|
|-|-|-|
|status|Integer|状态码 (参见 [HttpStatus](https://tools.ietf.org/html/rfc7231#section-6))|
|imageId|Integer|图片 Id|

## **下载图片**
从服务器下载图片。下载时，请使用 HTTP GET 方式
#### API地址
[GET] /image/download
#### GET参数 (非Json)
|参数|类型|说明|
|-|-|-|
|id|Integer|(必填) 图片 Id|
#### 返回数据 (非Json)
|参数|类型|说明|
|-|-|-|
|-|Stream|图片文件流|

## **创建报告**
上传报告信息到服务器。上传时，请使用 HTTP POST 方式，其中 enctype 为 'application/json; charset=UTF-8'
#### API地址
[POST] /archive/create
#### POST参数 (Json)
|参数|类型|说明|
|-|-|-|
|unit|String|(选填) 委托单位 (人)|
|phone|String|(选填) 联系电话|
|material|String|(选填) 提供资料情况|
|addr|String|(选填) 房屋地址|
|hold|String|(选填) 户主姓名|
|holdid|String|(选填) 户主身份证号|
|attr|String|(选填) 房屋属性，如：住宅 / 附属用房|
|layer|Integer|(选填) 层数|
|createyear|Integer|(选填) 建造年份|
|typeid|Integer|(必填) 结构类型 Id，可选值：1：砖混结构，2：砖木结构，3：底框结构，4：框架结构|
|body1|String|(选填) 关于"设计、施工、监理单位和相关资料"部分的模板字符串 (参见 [模板字符串](#模板字符串))|
|body2|String|(必填) 关于"基础和主体结构概况"部分的模板字符串 (参见 [模板字符串](#模板字符串))|
|body3|String|(必填) 关于"结构现状描述"部分的模板字符串 (参见 [模板字符串](#模板字符串))|
|remark|String|(选填) 备注|
|imgs|List (Integer)|(必填) 图片 Id 列表，长度不限 (参见 [上传图片](#上传图片))|
|damage|List (Integer)|(必填) 受损信息，长度 18<br><br>填以下数值：[共有中柱, 危险中柱, 共有边柱, 危险边柱, 共有角柱, 危险角柱, 共有屋架, 危险屋架, 共有中梁, 危险中梁, 共有边梁, 危险边梁, 共有称重墙体, 危险称重墙体, 共有楼板构件, 危险楼板构件, 共有围护构件, 危险围护构件]|

#### 返回数据 (Json)
|参数|类型|说明|
|-|-|-|
|status|Integer|状态码 (参见 [HttpStatus](https://tools.ietf.org/html/rfc7231#section-6))|
|archId|Integer|(必填) 报告 Id 列表，长度不限 (参见 [创建报告](#创建报告))|

## **下载报告**
从服务器下载报告压缩包。下载时，请使用 HTTP GET 方式
#### API地址
[GET] /archive/download
#### GEt参数 (Json)
|参数|类型|说明|
|-|-|-|
|ids|List (Integer)|报告 Id|
#### 返回数据 (非Json)
|参数|类型|说明|
|-|-|-|
|-|Stream|报告压缩包文件流|

## 模板字符串
#### 模板
* `{}` 代表顺序结构
	* 例如 `{abc}` 表示一个顺序结构，其中包含三个字母，顺序项被选择则其中包含的内容会被选择
* `[]` 代表选择结构
	* 例如 `[{a}{b}{c}]` 表示一个选择结构，其中包含三个选择项（注意：选择结构不能直接包含字符，而顺序结构能直接包含字符），根据给出的数值对选择项进行选择
* `()` 内包含选择分隔符，用于选择结构
	* 例如 `[(,){a}{b}{c}]` 表示选择结构在多选条件下用 `,` 分开被选择的选择项

#### 模板字符串
* 在 `;` 前的所有字符构成一个数字，表示之后的字符串按照这个数字的长度分割，分割后的每个子串构成一个数字，数字根据先后顺序依次使用来进行选择，对应的选择结构为模板中依次遇到的选择结构
	* 例如 `2;130105` 表示 `;` 之后的每两个字符构成一个数字，即 `13`, `1`, `5`
* 计算选择结构时，数字被转换成二进制来进行选择项选择
	* 例如选择结构 `[{a}{b}{c}]` 使用数字 `5` 来计算，则 `5` 被转换为二进制 `101`，从二进制的最低位 `1` 开始，对选择结构中的第一个选择项（即 `{a}`）进行判断，`1` 表示选中，`0` 表示不选中，则选中 `{a}`，接下来使用 `0` 对 `{b}` 进行判断，没有选中 `{b}`，最后使用 `1` 对 `{c}` 进行判断，选中 `{c}`，最终结果为 `ac`，若是数字转为二进制长度不够，则数字左边添 `0`
* 计算模板时，遇到选择结构则获取数字进行选择，之后计算被选择的选择项（即深度优先）
	* 例如模板 `[[{a}{b}]{c}]` 使用模板字符串 `1;32` 计算，首先计算最外层选择结构，获取数字 `3`  判断 `[{a}{b}]` 是否选中，选中，计算这个选择结构，使用获取数字 `2` 来判断 `{a}` 是否选中，不选中，然后判断 `{b}` 是否选中，选中，选择结构 `[{a}{b}]` 计算完毕，之后接着计算最外层选择结构，使用数字 `3` 判断 `{c}` 是否选中，选中，最终结果为 `bc`
* 对于相同的模板，根据选择不同，模板字符串长度可以不定

#### 目前的模板
* 砖木结构（"设计、施工、监理单位和相关资料"部分）
```
{该房屋无正规设计图纸，无正规施工单位和监理单位，设计和施工资料缺失。}
```
* 砖木结构（"基础和主体结构概况"部分）
```
{{1）建筑物上部主体结构为砖木结构，木柱下为石柱脚，砖墙下为砖砌条形基础；}{2）房屋主要以}[(、){砖墙}{木柱}{木屋架}{木檩条}]{承重，楼面为}[{木梁和木楼板}{木梁无楼板}]{，屋面为}[{木檩条挂小青瓦}]{。}}
```
* 砖木结构（"结构现状描述"部分）
```
{{1）基础工作基本正常，地基基础无明显不均匀沉降；}{2）上部承重构件工作基本正常，结构整体保持稳定，局部存在的质量缺陷有：}[(；){[(、){木梁}{木柱}{木屋架}{木檩条}]{存在}[{严重}{轻微}]{腐蚀现象}}{[(、){木梁}{木柱}{木屋架}{木檩条}]{存在}[{严重}{轻微}]{开裂现象}}{{柱脚有}[{严重}{轻微}][(、){变形}{倾斜}{破损}]{现象}}{{屋面板存在}[{严重}{轻微}][(、){破损}{渗水}]{现象}}]{。}}
```
* 砖木结构（"建议"部分，根据"结构现状描述"部分的输入模板字符串处理生成输入模板字符串，不需上传模板字符串）
```
{{对该房屋发现的质量缺陷和问题进行加固处理，加固处理需由有资质的单位实施。}{    质量缺陷加固处理方法建议：}[(；){对腐蚀的木质构件进行防腐处理，处理方法可以涂刷木质清漆}{对出现开裂的木质构件进行加固}{对问题柱脚进行加固修复}{[(、){对破损屋面进行修缮}{对渗水墙面重新进行防水处理}]}]{。}}
```